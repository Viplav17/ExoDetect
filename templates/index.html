<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>ExoDetect | AI Exoplanet Hunter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root{--bg:#0a0f18;--text:#eef2f7;--muted:#c6d0e1;--accent:#77e1ff;--warn:#ffc107;--radius-xl:28px;--radius-pill:9999px;--shadow-soft:0 10px 40px rgba(0,0,0,0.35);--maxw:1040px}
        *{box-sizing:border-box}
        html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;scroll-behavior:smooth}
        .main-nav{position:fixed;top:0;left:0;right:0;z-index:100;display:flex;justify-content:space-between;align-items:center;padding:18px clamp(16px, 4vw, 40px);background:linear-gradient(180deg, rgba(10,15,24,0.85) 0%, rgba(10,15,24,0) 100%);backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px)}
        .nav-brand{font-family:'Playfair Display',serif;font-weight:700;font-size:22px;text-decoration:none;color:var(--text)}
        .nav-links{display:flex;gap:24px;flex-wrap: wrap;}
        .nav-links a{text-decoration:none;color:var(--muted);font-weight:500;transition:color .2s ease}
        .nav-links a:hover{color:var(--accent)}
        .hero{position:relative;min-height:100svh;display:grid;place-items:center;overflow:hidden}
        .video-bg{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;object-fit:cover;opacity:0.4;}
        .hero::after{content:"";position:absolute;inset:0;background:radial-gradient(120% 120% at 50% 10%,rgba(0,0,0,0.05) 0%,rgba(0,0,0,0.26) 55%,rgba(0,0,0,0.42) 100%);pointer-events:none}
        .hero-content{position:relative;z-index:1;width:min(92vw, var(--maxw));text-align:center;padding:clamp(16px, 3vw, 24px)}
        .brand{font-family:'Playfair Display',serif;font-size:clamp(38px, 6.2vw, 66px);line-height:1.1;margin:0 0 10px 0;background:linear-gradient(120deg, #ffffff, var(--accent));-webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 2px 18px rgba(0,0,0,0.35);}
        .tagline{color:var(--muted);font-size:clamp(16px, 2.2vw, 20px);margin:0 auto;max-width:820px;text-shadow:0 2px 14px rgba(0,0,0,0.35);}
        .cta-row{margin-top:22px;display:flex;gap:12px;justify-content:center;flex-wrap:wrap;}
        .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;text-decoration:none;cursor:pointer;padding:14px 22px;border:1px solid rgba(255,255,255,0.20);background:rgba(255,255,255,0.1);color:#fff;border-radius:var(--radius-pill);box-shadow:var(--shadow-soft);transition:transform .2s ease, filter .2s ease, background .2s ease;font-weight:600}
        .btn:hover{transform:translateY(-2px);filter:brightness(1.05)}
        .btn-accent{background:linear-gradient(180deg, rgba(119,225,255,0.88), rgba(119,225,255,0.48));border-color:rgba(119,225,255,0.65);}
        .section{scroll-margin-top:16px;padding:clamp(32px, 6vw, 80px) 16px;display:grid;place-items:center;position:relative;overflow:hidden; border-top: 1px solid rgba(255,255,255,0.1);}
        .starry{background-color:#0a0f18;background-image:url('/static/Sky-Background.jpeg');background-size: cover; background-repeat: no-repeat; background-attachment:fixed;}
        .card{position:relative;z-index:1;width:min(92vw, var(--maxw));background:rgba(14, 18, 28, 0.62);border:1px solid rgba(255,255,255,0.16);border-radius:var(--radius-xl);box-shadow:var(--shadow-soft);padding:clamp(20px, 4vw, 36px);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px)}
        .card h2{font-family:'Playfair Display',serif;font-size:clamp(24px, 3.6vw, 36px);margin:0 0 8px 0;}
        .card h3{margin:0 0 8px 0;font-family:'Playfair Display',serif;font-size:clamp(20px, 3.4vw, 30px)}
        .card p{margin:0 0 18px 0;color:var(--muted); line-height: 1.6;}
        .form-row{display:flex;flex-wrap:wrap;align-items:center;gap:12px;margin-top:8px}
        .select, .input-field{padding:14px 18px;border-radius:var(--radius-pill);border:1px solid rgba(255,255,255,0.32);background-color:rgba(8,14,22,0.94);color:#fff;min-width:240px;font-weight:700;box-shadow:var(--shadow-soft);}
        .select {background-image:linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.05)), url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 20 20" fill="white"><path d="M5.5 7.5l4.5 5 4.5-5" stroke="white" stroke-width="1.6" fill="none"/></svg>');background-repeat:no-repeat, no-repeat;background-position:0 0, right 14px center;padding-right:44px}
        .muted-note{color:var(--muted);font-size:0.95rem;margin-top:10px}
        .grid{width:min(92vw, var(--maxw));display:grid;gap:16px}
        .panel{position:relative;z-index:1;background:rgba(255,255,255,0.08);border-radius:var(--radius-xl);padding:clamp(16px, 3.6vw, 28px);}
        .hidden{display:none !important}
        .form-grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));gap:20px;margin-top:24px}
        .form-grid > div{display:flex;flex-direction:column}
        .form-grid label{font-size:0.9rem;font-weight:500;color:var(--muted);margin-bottom:6px}
        .form-grid input{padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.32);background-color:rgba(8,14,22,0.94);color:#fff;}
        .result-panel{margin-top:24px;padding:20px;border-radius:12px;border:1px solid;text-align:center}
        .result-panel h4{margin:0 0 8px 0;font-size:24px;font-family:'Playfair Display',serif}
        .result-true{border-color:#2ac8a0;background:rgba(42,200,160,0.1)}
        .result-false{border-color:#ff6b6b;background:rgba(255,107,107,0.1)}
        .modal-overlay{position:fixed;inset:0;background:rgba(10, 15, 24, 0.8);backdrop-filter:blur(8px);z-index:200;display:grid;place-items:center;opacity:0;transition:opacity .3s ease;pointer-events:none}
        .modal-overlay:not(.hidden){opacity:1;pointer-events:auto}
        .modal-card{width:min(90vw, 500px);background:var(--bg);border-radius:var(--radius-xl);padding:clamp(20px, 4vw, 36px);text-align:center}
        .archive-result-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px; margin-top: 20px;}
        .archive-result-grid .item { background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; }
        .archive-result-grid .key { font-size: 0.8rem; font-weight: 600; color: var(--muted); display: block; }
        .archive-result-grid .value { font-size: 1rem; color: var(--text); }
        .stats-grid{margin-top:28px;display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;text-align:center}
        .stats-grid > div{padding:16px;background:rgba(255,255,255,0.05);border-radius:12px}
        .stats-grid h4{margin:0 0 4px 0;color:var(--muted);font-weight:500;}
        .stats-grid .stat{font-size:1.8rem;font-weight:700;margin:0;color:var(--accent); font-family: 'Playfair Display', serif;}
        .footer { padding: 40px 16px; text-align: center; color: var(--muted); font-size: 0.9rem; }
    </style>
</head>
<body>

<video autoplay muted loop class="video-bg">
    <source src="{{ url_for('static', filename='galaxy_reverse.mp4') }}" type="video/mp4">
    Your browser does not support the video tag.
</video>

<header class="hero" id="home">
    <div class="hero-content">
        <h1 class="brand">ExoDetect</h1>
        <p class="tagline">An intelligent toolkit for discovering worlds beyond our Sun—offering a streamlined path from mission selection to data-driven discovery.</p>
        <div class="cta-row">
            <a href="#console" class="btn btn-accent">Start Exploring &darr;</a>
        </div>
    </div>
</header>

<nav class="main-nav">
    <a href="/" class="nav-brand">ExoDetect</a>
    <div class="nav-links">
        <a href="#console">Console</a>
        <a href="#data">Workspace</a>
        <a href="/config">Configure & Performance</a>
        <a href="#archive">Archive</a>
        <a href="#science">How It Works</a>
    </div>
</nav>

<main>
    <section class="section starry" id="console">
        <div class="card">
            <h2>Researcher Console</h2>
            <p>Select a mission to load the corresponding AI model and data workspace.</p>
            <div class="form-row">
                <select id="mission" class="select">
                    <option value="" selected disabled>Choose a mission…</option>
                    <option value="kepler">Kepler</option>
                    <option value="tess">TESS</option>
                    <option value="k2">K2</option>
                </select>
                <a id="goData" class="btn" href="#data">Go to Workspace &rarr;</a>
            </div>
            <p class="muted-note" id="missionNote">No mission selected. Model is idle.</p>
        </div>
    </section>

    <section class="section starry" id="data">
        <div class="grid">
            <div class="panel">
                <h2 id="dataTitle" style="margin:0;">Data Workspace</h2>
                <p class="muted" id="workspace-subtitle">Select a mission from the console above to begin.</p>
            </div>
            
            <div id="panel-kepler" class="panel hidden">
                <h3>Kepler Candidate Input</h3>
                <form id="kepler-form" class="data-form">
                    <input type="hidden" name="mission" value="kepler">
                    <div class="form-grid">
                        <div><label>Not Transit-Like Flag</label><input type="number" name="koi_fpflag_nt" value="0" required></div>
                        <div><label>Stellar Variability Flag</label><input type="number" name="koi_fpflag_ss" value="0" required></div>
                        <div><label>Centroid Offset Flag</label><input type="number" name="koi_fpflag_co" value="0" required></div>
                        <div><label>Eclipsing Binary Flag</label><input type="number" name="koi_fpflag_ec" value="0" required></div>
                        <div><label>Orbital Period [d]</label><input type="number" step="any" name="koi_period" placeholder="e.g., 9.488" required></div>
                        <div><label>Transit Epoch</label><input type="number" step="any" name="koi_time0bk" placeholder="e.g., 170.538" required></div>
                        <div><label>Impact Parameter</label><input type="number" step="any" name="koi_impact" placeholder="e.g., 0.146" required></div>
                        <div><label>Transit Duration [hr]</label><input type="number" step="any" name="koi_duration" placeholder="e.g., 2.957" required></div>
                        <div><label>Transit Depth [ppm]</label><input type="number" step="any" name="koi_depth" placeholder="e.g., 615.8" required></div>
                        <div><label>Planetary Radius [Re]</label><input type="number" step="any" name="koi_prad" placeholder="e.g., 2.26" required></div>
                        <div><label>Equilibrium Temp [K]</label><input type="number" name="koi_teq" placeholder="e.g., 793" required></div>
                        <div><label>Insolation Flux</label><input type="number" step="any" name="koi_insol" placeholder="e.g., 93.59" required></div>
                        <div><label>Transit SNR</label><input type="number" step="any" name="koi_model_snr" placeholder="e.g., 35.8" required></div>
                        <div><label>Stellar Eff. Temp [K]</label><input type="number" name="koi_steff" placeholder="e.g., 5455" required></div>
                        <div><label>Stellar Gravity</label><input type="number" step="any" name="koi_slogg" placeholder="e.g., 4.467" required></div>
                        <div><label>Stellar Radius [Rs]</label><input type="number" step="any" name="koi_srad" placeholder="e.g., 0.927" required></div>
                        <div><label>RA [deg]</label><input type="number" step="any" name="ra" placeholder="e.g., 291.934" required></div>
                        <div><label>Dec [deg]</label><input type="number" step="any" name="dec" placeholder="e.g., 48.141" required></div>
                        <div><label>Kepler-band Mag.</label><input type="number" step="any" name="koi_kepmag" placeholder="e.g., 15.347" required></div>
                    </div>
                    <button type="submit" class="btn btn-accent" style="margin-top: 24px;">Analyze & Update Model</button>
                </form>
                <div id="prediction-result-kepler" class="result-panel hidden"></div>
            </div>
            
            <div id="panel-tess" class="panel hidden">
                <h3>TESS Candidate Input</h3>
                <form id="tess-form" class="data-form">
                    <input type="hidden" name="mission" value="tess">
                    <div class="form-grid">
                        <div><label>Orbital Period [d]</label><input type="number" step="any" name="pl_orbper" required></div>
                        <div><label>Planet Radius [Re]</label><input type="number" step="any" name="pl_rade" required></div>
                        <div><label>Insolation Flux</label><input type="number" step="any" name="pl_insol" required></div>
                        <div><label>Stellar Eff. Temp [K]</label><input type="number" name="st_teff" required></div>
                        <div><label>Stellar Radius [Rs]</label><input type="number" step="any" name="st_rad" required></div>
                    </div>
                    <button type="submit" class="btn btn-accent" style="margin-top: 24px;">Analyze & Update Model</button>
                </form>
                <div id="prediction-result-tess" class="result-panel hidden"></div>
            </div>
            
            <div id="panel-k2" class="panel hidden">
                <h3>K2 Candidate Input</h3>
                <form id="k2-form" class="data-form">
                    <input type="hidden" name="mission" value="k2">
                    <div class="form-grid">
                        <div><label>Orbital Period [d]</label><input type="number" step="any" name="pl_orbper" required></div>
                        <div><label>Planet-Star Radius Ratio</label><input type="number" step="any" name="pl_ror" required></div>
                        <div><label>Insolation Flux</label><input type="number" step="any" name="pl_insol" required></div>
                        <div><label>Stellar Eff. Temp [K]</label><input type="number" name="st_teff" required></div>
                        <div><label>Stellar Radius [Rs]</label><input type="number" step="any" name="st_rad" required></div>
                    </div>
                    <button type="submit" class="btn btn-accent" style="margin-top: 24px;">Analyze & Update Model</button>
                </form>
                <div id="prediction-result-k2" class="result-panel hidden"></div>
            </div>
        </div>
    </section>
    
    <section class="section starry" id="archive">
        <div class="card">
            <h2>Data Archive Search</h2>
            <p>Look up a target from its original dataset by name or ID.</p>
            <form id="archive-form">
                <div class="form-row">
                    <select id="archive-mission" class="select" required>
                        <option value="" selected disabled>Select mission...</option>
                        <option value="kepler">Kepler</option>
                        <option value="tess">TESS</option>
                        <option value="k2">K2</option>
                    </select>
                    <input type="text" id="archive-query" class="input-field" placeholder="Select mission first..." required style="flex-grow: 1;">
                    <button type="submit" class="btn">Search Archive</button>
                </div>
            </form>
            <div id="archive-result" class="hidden" style="margin-top: 24px;"></div>
        </div>
    </section>

    <section class="section starry" id="science">
        <div class="card">
            <h2>How It Works: Science & Technology</h2>
            <h3>The Transit Method</h3>
            <p>This project identifies exoplanets using the transit method. When a planet passes in front of its star, it blocks a tiny fraction of the star's light. Telescopes like Kepler are designed to detect these periodic, minuscule dips in starlight. The characteristics of these dips reveal a planet's size, orbit, and more.</p>
            <h3>AI & Machine Learning</h3>
            <p>We use a <strong>Gradient Boosting Classifier</strong>, a powerful machine learning algorithm. The model is trained on thousands of confirmed planets and known false positives from NASA's datasets. It learns the complex patterns between dozens of variables (like orbital period, transit depth, stellar radius) that distinguish a genuine exoplanet from a false alarm. When you input new data, the model uses its learned patterns to classify the candidate with a high degree of accuracy.</p>
        </div>
    </section>
</main>

<footer class="footer">
    <p>ExoDetect | AI Exoplanet Hunter</p>
</footer>

<div id="confirmation-modal" class="modal-overlay hidden">
    <div class="modal-card">
        <h3>Confirm Submission</h3>
        <p>Is the data correct and ready for analysis? Submitting will also add this data to the model's training set for future improvements.</p>
        <div style="display:flex; justify-content:center; gap:12px;">
            <button id="confirm-no" class="btn">Go Back</button>
            <button id="confirm-yes" class="btn btn-accent">Yes, Analyze</button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const missionEl = document.getElementById('mission');
    const goData = document.getElementById('goData');
    const missionNote = document.getElementById('missionNote');
    const panels = { kepler: document.getElementById('panel-kepler'), tess: document.getElementById('panel-tess'), k2: document.getElementById('panel-k2') };

    function showPanel(mission) {
        if (!mission) return;
        Object.values(panels).forEach(el => el.classList.add('hidden'));
        if(panels[mission]) panels[mission].classList.remove('hidden');
        document.getElementById('dataTitle').textContent = `${mission.charAt(0).toUpperCase() + mission.slice(1)} • Data Workspace`;
        document.getElementById('workspace-subtitle').textContent = `Enter data for a ${mission.toUpperCase()} candidate below.`;
    }
    
    missionEl.addEventListener('change', () => {
        missionNote.textContent = `Mission selected: ${missionEl.value.toUpperCase()}.`;
    });
    
    goData.addEventListener('click', (e) => {
        const val = missionEl.value;
        if (!val) {
            e.preventDefault();
            missionNote.textContent = 'Please choose a mission first.';
        } else {
            showPanel(val);
        }
    });

    const confirmationModal = document.getElementById('confirmation-modal');
    const confirmYesBtn = document.getElementById('confirm-yes');
    const confirmNoBtn = document.getElementById('confirm-no');
    let activeForm = null;

    document.querySelectorAll('.data-form').forEach(form => {
        form.addEventListener('submit', (event) => {
            event.preventDefault();
            activeForm = form;
            confirmationModal.classList.remove('hidden');
        });
    });

    confirmYesBtn.addEventListener('click', () => {
        if (!activeForm) return;
        const mission = activeForm.querySelector('input[name="mission"]').value;
        const resultPanel = document.getElementById(`prediction-result-${mission}`);
        
        confirmationModal.classList.add('hidden');
        resultPanel.classList.remove('hidden', 'result-true', 'result-false');
        resultPanel.innerHTML = '<p>Analyzing... This may take a moment as the model updates.</p>';

        const formData = new FormData(activeForm);
        fetch('/predict', { method: 'POST', body: formData })
            .then(res => res.json())
            .then(data => {
                if (data.error) {
                    displayResult(resultPanel, false, 'Error', data.error);
                } else {
                    const isPlanet = data.prediction === 1;
                    const resultText = isPlanet ? 'Likely Planet Candidate' : 'Likely False Positive';
                    displayResult(resultPanel, isPlanet, resultText, `Confidence: ${data.confidence}%`);
                }
            }).catch(error => displayResult(resultPanel, false, 'Network Error', 'Could not connect to the server.'));
    });
    
    function displayResult(panel, isSuccess, title, description) {
        panel.classList.remove('hidden');
        panel.classList.toggle('result-true', isSuccess);
        panel.classList.toggle('result-false', !isSuccess);
        panel.innerHTML = `<h4>${title}</h4><p>${description}</p>`;
    }

    confirmNoBtn.addEventListener('click', () => confirmationModal.classList.add('hidden'));
    
    const archiveForm = document.getElementById('archive-form');
    const archiveQueryInput = document.getElementById('archive-query');
    const archiveResultDiv = document.getElementById('archive-result');
    const archiveMissionSelect = document.getElementById('archive-mission');
    
    const archivePlaceholders = {
        kepler: 'Enter Kepler ID or KOI Name...',
        tess: 'Enter TESS ID or TOI Name...',
        k2: 'Enter EPIC Number or K2 Name...'
    };

    archiveMissionSelect.addEventListener('change', () => {
        archiveQueryInput.placeholder = archivePlaceholders[archiveMissionSelect.value] || 'Select mission...';
    });

    archiveForm.addEventListener('submit', function(event) {
        event.preventDefault();
        archiveResultDiv.classList.remove('hidden');
        archiveResultDiv.innerHTML = `<p>Searching the archive...</p>`;
        
        const formData = new FormData(archiveForm);

        fetch('/search_archive', { method: 'POST', body: formData })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    archiveResultDiv.innerHTML = `<p style="color: var(--warn);">${data.error}</p>`;
                } else {
                    let resultHTML = '<div class="archive-result-grid">';
                    for (const [key, value] of Object.entries(data)) {
                        if (value !== '' && value !== null) {
                            resultHTML += `<div class="item"><span class="key">${key}</span><span class="value">${value}</span></div>`;
                        }
                    }
                    resultHTML += '</div>';
                    archiveResultDiv.innerHTML = resultHTML;
                }
            })
            .catch(error => {
                archiveResultDiv.innerHTML = `<p style="color: var(--warn);">An error occurred while searching.</p>`;
            });
    });
});
</script>

</body>
</html>